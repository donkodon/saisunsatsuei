# 🚨 緊急ログデバッグガイド

## 📋 状況

**ログが一個も出ない** → 処理が実行されていない証拠

---

## ✅ 追加した超強力ログ

### 1️⃣ アプリ起動時（main.dart）
```
============================================================
🚀🚀🚀 Cargo Measure アプリ起動！ 🚀🚀🚀
============================================================
⏰ 起動時刻: 2026-01-09 15:50:00.000
🔍 このログが見えていれば、ログ出力は正常です
📱 これからログを監視してください
============================================================
```

**このログが出ない場合**: ブラウザのコンソールが開いていない

---

### 2️⃣ 商品確定ボタンタップ時
```
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🔘 商品確定ボタンがタップされました
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
```

**このログが出ない場合**: ボタンが押されていない、またはボタンが無効化されている

---

### 3️⃣ _saveProduct() 関数実行時
```
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 _saveProduct() 関数が呼ばれました！
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
```

**このログが出ない場合**: 関数が呼ばれる前にエラーが発生している

---

### 4️⃣ AI採寸判定時
```
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
✅ 商品確定ボタンが押されました
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
📏 AI自動採寸トグル: ✅ ON または ❌ OFF
📸 アップロード済み画像: ✅ あり または ❌ なし
📸 画像数: 3枚
🎯 最初の画像URL: https://...
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
```

**このログが出ない場合**: 画像アップロード前にエラーが発生している

---

### 5️⃣ MeasurementService 実行時
```
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 MeasurementService 実行開始
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
📥 パラメータ:
   imageUrl: https://...
   sku: 1025L280002
   companyId: xxx
   category: トップス
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
```

**このログが出ない場合**: 
- AI採寸トグルがOFF
- 画像がアップロードされていない

---

### 6️⃣ エラー発生時
```
❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌
❌ _saveProduct() でエラー発生！
❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌
エラー: ...
スタックトレース: ...
❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌❌
```

**このログが出た場合**: エラー内容とスタックトレースを確認

---

## 🧪 テスト手順（超詳細版）

### Step 1: アプリをリロード

```bash
# ブラウザで Ctrl+Shift+R (強制リロード)
```

---

### Step 2: ブラウザのコンソールを開く

**Chrome / Edge**:
```
1. F12 を押す
2. "Console" タブをクリック
3. 右クリック → "Clear console" でログをクリア
```

**Firefox**:
```
1. F12 を押す
2. "コンソール" タブをクリック
3. ゴミ箱アイコンをクリックしてログをクリア
```

**Safari**:
```
1. Option + Command + I を押す
2. "Console" タブをクリック
3. ゴミ箱アイコンをクリックしてログをクリア
```

---

### Step 3: アプリ起動ログを確認

**期待されるログ**:
```
============================================================
🚀🚀🚀 Cargo Measure アプリ起動！ 🚀🚀🚀
============================================================
```

**✅ このログが出た**: ログ出力は正常
**❌ このログが出ない**: ブラウザのコンソールが正しく開いていない → Step 2 をやり直す

---

### Step 4: 商品登録画面へ移動

1. ログイン（必要な場合）
2. 新規商品登録画面へ移動

---

### Step 5: AI採寸トグルをON

**重要**: トグルが **ON（緑色）** になっていることを確認

---

### Step 6: 写真を撮影

**重要**: 最低1枚の写真を撮影

---

### Step 7: 商品名とSKUを入力

- 商品名: 「テスト商品」
- SKU: 「TEST_DEBUG_001」

---

### Step 8: 「次へ」ボタンを押す

**期待されるログ**:
```
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
📱 商品詳細画面への遷移
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
📏 AI自動採寸トグル: ✅ ON
📸 画像数: 1枚
📦 商品名: テスト商品
🏷️  SKU: TEST_DEBUG_001
→ DetailScreen に aiMeasureEnabled=true を渡す
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
```

**✅ このログが出た**: 正常
**❌ このログが出ない**: AddItemScreen に問題がある

---

### Step 9: 「商品確定」ボタンを押す

**期待されるログ（順番に出る）**:

**9-1. ボタンタップ**:
```
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🔘 商品確定ボタンがタップされました
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
```

**9-2. 関数実行**:
```
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🚀 _saveProduct() 関数が呼ばれました！
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
```

**9-3. AI採寸判定**:
```
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
✅ 商品確定ボタンが押されました
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
📏 AI自動採寸トグル: ✅ ON
📸 アップロード済み画像: ✅ あり
📸 画像数: 1枚
🎯 最初の画像URL: https://...
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
```

**9-4. MeasurementService 実行**:
```
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
🤖 MeasurementService 実行開始
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
📥 パラメータ:
   imageUrl: https://firebasestorage.googleapis.com/...
   sku: TEST_DEBUG_001
   companyId: xxx
   category: トップス
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
```

**9-5. API呼び出し成功**:
```
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
✅ AI採寸リクエスト送信成功！
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
📡 prediction_id: abc123def456
💾 ローカルDB記録完了
⏳ Webhook経由でD1に以下が保存されます:
   - measurements (肩幅/袖丈/着丈/身幅)
   - ai_landmarks (ランドマーク座標)
   - reference_object (基準物体情報)
   - measurement_image_url (採寸画像)
   - mask_image_url (マスク画像)
🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
```

---

## 📊 ログが出ない場合の切り分け

### ケース1: アプリ起動ログすら出ない
**原因**: ブラウザのコンソールが正しく開いていない
**対処**: Step 2 をやり直す

---

### ケース2: 「次へ」ボタンのログが出ない
**原因**: ボタンが押されていない、またはバリデーションエラー
**対処**: 
- 商品名が入力されているか確認
- 商品の状態が選択されているか確認
- エラーメッセージが表示されていないか確認

---

### ケース3: 「商品確定」ボタンのログが出ない
**原因**: ボタンが無効化されている、または画面が表示されていない
**対処**: 
- 商品詳細画面が表示されているか確認
- ボタンが表示されているか確認
- ボタンをタップしてもログが出ない場合、アプリのバージョンが古い可能性

---

### ケース4: 「_saveProduct() 関数が呼ばれました」ログが出ない
**原因**: ボタンタップから関数実行の間でエラーが発生
**対処**: 
- エラーログが出ていないか確認
- ブラウザのコンソールに赤いエラーメッセージが出ていないか確認

---

### ケース5: 「AI採寸判定」ログが出ない
**原因**: 画像アップロードに失敗している
**対処**: 
- 画像がアップロードされているか確認
- Firebase Storage の権限を確認
- エラーログを確認

---

### ケース6: 「MeasurementService 実行開始」ログが出ない
**原因**: 
- AI採寸トグルがOFF
- 画像がアップロードされていない

**対処**: 
- AI採寸トグルをONにする
- 画像を撮影する
- 「AI自動採寸トグル: ❌ OFF」または「アップロード済み画像: ❌ なし」というログが出ているか確認

---

### ケース7: エラーログが出る
**原因**: 具体的なエラーが発生している
**対処**: 
- エラーメッセージとスタックトレースを確認
- エラー内容を報告

---

## 🆘 それでもログが出ない場合

以下の情報を提供してください:

1. **ブラウザの種類とバージョン**:
   - Chrome 120.0.0.0
   - Firefox 121.0
   - Safari 17.2
   - など

2. **OS**:
   - Windows 11
   - macOS Sonoma
   - など

3. **アプリのURL**:
   - https://5060-xxx.sandbox.novita.ai

4. **コンソールのスクリーンショット**:
   - F12 → Console タブ → スクリーンショット

5. **実行した操作**:
   - ログイン → 新規商品登録 → ...

---

## ✅ まとめ

**これらのログが順番に出れば、AI採寸は正常に動作します。**

ログが出ない場合、**どのログまで出たか**を確認して、問題箇所を特定してください。
